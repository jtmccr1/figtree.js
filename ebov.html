<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FigTree Demo</title>
    <script src="js/d3.js" charset="utf-8"></script>
    <!--<script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>-->
    <style>
        text {
            font-family: "helvetica-neue",  "helvetica",  "sans-serif";
            font-size: 10pt;
            font-weight: 300;
        }

        .branch {
            fill: none;
            stroke: #541753;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .branch.hovered {
            stroke-width: 4;
        }

        .node-background {
            fill: #541753;
        }

        .node-shape {
            fill: #22b680;
        }

        .external-node .node-shape.hovered {
            fill: #edb23b;
        }
        .external-node .node-shape.unselected {
            fill: #22b680;
            /*stroke: rgb(255, 255, 255);*/
        }
        .external-node .node-shape.selected {
            fill: #edb23b;
            /*stroke: rgb(0,0,0);*/
        }

        .internal-node .node-shape {
            fill: #29c5ef;
            /*stroke: rgb(255, 255, 255);*/
            /*stroke-width: 1;*/
            display: none;
        }

        #root .node-shape {
            fill: #e31e58;
            stroke: rgb(255, 255, 255);
            stroke-width: 1;
            display: none;
        }

        .node-label {
            font-family: "helvetica-neue",  "helvetica",  "sans-serif";
            font-size: 8pt;
            font-weight: 300;
        }

        .trend-line {
            stroke: rgb(0,0,0);
            stroke-width: 2;
            stroke-linecap: round;
        }

        .axis text {
            font-family: "helvetica-neue",  "helvetica",  "sans-serif";
            font-size: 8pt;
            font-weight: 300;
        }

        .axis-label text {
            font-family: "helvetica-neue",  "helvetica",  "sans-serif";
            font-size: 8pt;
            font-weight: bold;
        }

        .node-label.support {
            font-size: 10pt;
        }

        .branch-label.length {
            display: none;
            font-size: 8pt;
        }

        #tooltip {
            background: #F6EECA;
            border: 1px solid #005C68;
            color: #005C68;
            border-radius: 5px;
            padding: 5px;
            font-family: "helvetica-neue",  "helvetica",  "sans-serif";
            font-size: 12pt;
            font-weight: 300;
        }
    </style>
</head>

<body>
<div id="tooltip" display="none" style="position: absolute; display: none;"></div>

<div>
    <!--
    <div>
    Click on a node to include/exclude it from the regression. Click on a branch to reroot the tree at that position.
    </div>
    -->
    <svg id="tree-2-svg"  width="450" height="400"></svg>
    <svg id="rrt-2-svg"  width="400" height="400"></svg>
</div>

<script type="module">
    import { Tree } from "./src/tree.js";
    import { RectangularLayout } from "./src/rectangularlayout.js";
    import { CircleBauble } from "./src/bauble.js";
    import { FigTree } from "./src/figtree.js";
    import { RootToTipPlot } from "./src/roottotipplot.js";

    const timeTreeString =
        '((Bonduni_DRC_1977-06:5.3E-5,Yambuku-Mayinga_DRC_1976-10-01:2.0E-6):0.002186,((Muembe1_DRC_2017-05:0.007975,Beni-18FHV090_DRC_2018-07-28:0.00898):0.002026,(((Ilembe_Gabon_2002-02-23:0.001437,Kelle_2_COG_2003-10:0.001852):0.01144,(Makona-C07_Guinea_2014-03-20:0.020514,(034-KS_DRC_2008-12-31:5.43E-4,M-M_DRC_2007-08-31:4.5E-5):0.009434):2.05E-4):0.005346,(Kikwit-9510621_DRC_1995-05-04:0.003643,((Lomela-Lokolia16_DRC_2014-08-20:0.002216,BIK009-Bikoro_DRC_2018-05-10:0.002896):0.001998,(2Nza_Gabon_1996-10-27:0.002238,(Gabon_Gabon_1994-12-27:7.94E-4,1Eko_Gabon_1996-02:0.00106):6.25E-4):0.004065):5.18E-4):0.003691):2.81E-4):0.002186);';

    const tree = Tree.parseNewick(timeTreeString, null, "_");
    const treeSVG = document.getElementById('tree-2-svg');
    const layout = new RectangularLayout(tree);
    const figTree = new FigTree(treeSVG, layout,
        { top: 10, bottom: 60, left: 20, right: 190},
        {   hoverBorder: 2, backgroundBorder: 2,
            baubles: [
                new CircleBauble({ vertexFilter: (v) => v.degree === 1 }),
            ]
        });

    figTree.hilightBranches();
    figTree.onClickBranch(layout.reroot());

    figTree.hilightExternalNodes();
    // figTree.onClickNode(layout.rotate());

    figTree.addToolTip('.external-node', FigTree.nodeInfo);

    const rrtp = new RootToTipPlot(document.getElementById('rrt-2-svg'), tree, { top: 10, bottom: 60, left: 60, right: 20},
        { slopeFormat: ",.5f" });

    rrtp.addToolTip('.external-node', RootToTipPlot.nodeInfo);

    rrtp.linkWithTree(treeSVG);

    rrtp.selectTips(treeSVG, ["Muembe1_DRC_2017-05", "Beni-18FHV090_DRC_2018-07-28", "Lomela-Lokolia16_DRC_2014-08-20", "BIK009-Bikoro_DRC_2018-05-10"]);

</script>

</body>

</html>
